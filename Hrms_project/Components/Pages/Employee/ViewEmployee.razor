@page "/ViewEmployee/{id}"
@using HrmsSolution.Service
@using Datamodels.Hrms
@inject IEmployeeService EmployeeService
@* เรียกใช้ Service สำหรับ View โดยเฉพาะ *@
@inject IVEmployeeDetailsService EmployeeDetailsService
@inject SweetAlertService Swal
@inject NavigationManager Navigation

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3><i class="bi bi-person-badge me-2"></i>รายละเอียดบุคลากร</h3>
        <button class="btn btn-outline-secondary" @onclick="GoBack">
            <i class="bi bi-arrow-left"></i> ย้อนกลับ
        </button>
    </div>

    @if (selectemployee != null)
    {
        @* --- ส่วนที่ 1: แสดง Card ตัวบุคคล (ภาพรวม) --- *@
        <div class="row mb-4">
            <div class="col-12">
                <EmployeeCard EmployeeData="selectemployee" />
            </div>
        </div>

        @* --- ส่วนที่ 2: ข้อมูลเพิ่มเติม (รายละเอียดเจาะลึก) --- *@
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-header bg-white fw-bold">
                        <i class="bi bi-info-circle me-2 text-primary"></i>ข้อมูลการระบุตัวตน
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between">
                                <span class="text-muted">Citizen ID:</span>
                                <span>@selectemployee.CitizenId</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span class="text-muted">รหัสพนักงาน:</span>
                                <span>@selectemployee.EmployeeId</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span class="text-muted">อีเมล:</span>
                                <span>@selectemployee.Email</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-header bg-white fw-bold">
                        <i class="bi bi-briefcase me-2 text-primary"></i>ข้อมูลการจ้างงาน
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between">
                                <span class="text-muted">วันที่เริ่มงาน:</span>
                                <span>@selectemployee.StartDate</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span class="text-muted">ตำแหน่ง:</span>
                                <span>@selectemployee.PositionId</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span class="text-muted">หน่วยงาน:</span>
                                <span>@selectemployee.UnitId</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-3 text-muted">กำลังค้นหาข้อมูลพนักงาน...</p>
        </div>
    }
</div>

@code {
    [Parameter] public string id { get; set; } = "";
    private VEmployeeDetail? selectemployee;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // ดึงข้อมูลผ่าน Service ที่เราทำ Trimming รูปภาพไว้แล้ว
            selectemployee = await EmployeeDetailsService.GetEmployeeDetailsByIdAsync(id);

            if (selectemployee == null)
            {
                await Swal.FireAsync("Not Found", "ไม่พบข้อมูลพนักงานท่านนี้ในระบบ", SweetAlertIcon.Question);
                Navigation.NavigateTo("/employees");
            }
        }
        catch (Exception ex)
        {
            await Swal.FireAsync("Error", "ไม่สามารถติดต่อฐานข้อมูลได้: " + ex.Message, SweetAlertIcon.Error);
        }
    }

    private void GoBack() => Navigation.NavigateTo("/employees");
}