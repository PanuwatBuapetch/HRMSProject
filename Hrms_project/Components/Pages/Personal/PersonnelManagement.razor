@page "/personnel"
@using System.ComponentModel.DataAnnotations

<PageTitle>ข้อมูลบุคลากร</PageTitle>

<div class="personnel-container">
    <div class="page-header">
        <h4 class="page-title">ข้อมูลบุคลากร</h4>
    </div>

    <div class="content-card">
        <!-- Search and Filter Section -->
        <div class="filter-section">
            <div class="row g-3 align-items-end">
                <div class="col-md-3">
                    <div class="search-box">
                        <input type="text" class="form-control" placeholder="ค้นหาชื่อ-สกุล อีเมล" @bind="searchText" @bind:event="oninput" />
                        <button class="search-btn">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-auto ms-auto">
                    <button class="btn btn-success" @onclick="ShowAddModal">
                        <i class="bi bi-plus-circle"></i> เพิ่มบุคลากร
                    </button>
                </div>
            </div>

            <div class="row g-3 mt-2">
                <div class="col-md-2">
                    <select class="form-select form-select-sm" @bind="filterFirstName">
                        <option value="">ชื่อ-สกุล (ภาษาไทย)</option>
                        <option value="สมชาย">สมชาย</option>
                        <option value="สมหญิง">สมหญิง</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select form-select-sm" @bind="filterLastName">
                        <option value="">ชื่อ-สกุล (ภาษาอังกฤษ)</option>
                        <option value="Admin">Admin</option>
                        <option value="Manager">Manager</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select form-select-sm" @bind="filterEmail">
                        <option value="">อีเมล</option>
                        <option value="company.com">company.com</option>
                        <option value="gmail.com">gmail.com</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select form-select-sm" @bind="filterDivision1">
                        <option value="">หน่วยงานระดับ 1</option>
                        <option value="มหาวิทยาลัยสงขลานครินทร์">มหาวิทยาลัยสงขลานครินทร์</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select form-select-sm" @bind="filterDivision2">
                        <option value="">หน่วยงานระดับ 2</option>
                        <option value="คณะวิทยาการจัดการ">คณะวิทยาการจัดการ</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select form-select-sm" @bind="filterPosition">
                        <option value="">สายงานสร้างงาน</option>
                        <option value="กรรมการสภา">กรรมการสภา</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select form-select-sm" @bind="filterStatus">
                        <option value="">จัดการสถานะ</option>
                        <option value="Active">กิจกรรม</option>
                        <option value="Inactive">ไม่กิจกรรม</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select form-select-sm" @bind="filterAction">
                        <option value="">การจัดการ</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Personnel Table -->
        <div class="table-container">
            <table class="personnel-table">
                <thead>
                    <tr>
                        <th>ผู้บุคลากร</th>
                        <th>ชื่อ-สกุล (ภาษาไทย)</th>
                        <th>ชื่อ-สกุล (ภาษาอังกฤษ)</th>
                        <th>อีเมล</th>
                        <th>หน่วยงานระดับ 1</th>
                        <th>หน่วยงานระดับ 2</th>
                        <th>สายงานสร้างงาน</th>
                        <th>จัดการสถานะ</th>
                        <th>การจัดการ</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var person in FilteredPersonnel)
                    {
                        <tr>
                            <td>@person.EmployeeCode</td>
                            <td>@person.FullNameThai</td>
                            <td>@person.FullNameEnglish</td>
                            <td>@person.Email</td>
                            <td>
                                @person.Division1
                                @if (!string.IsNullOrEmpty(person.Division1Note))
                                {
                                    <span class="badge bg-secondary ms-1">@person.Division1Note</span>
                                }
                            </td>
                            <td>@person.Division2</td>
                            <td>@person.CareerPath</td>
                            <td>
                                <label class="status-switch">
                                    <input type="checkbox" checked="@person.IsActive" />
                                    <span class="slider"></span>
                                </label>
                                <span class="badge bg-@(person.IsActive ? "info" : "secondary") ms-2">
                                    @(person.IsActive ? "กิจกรรม" : "ไม่กิจกรรม")
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-action btn-info" @onclick="() => ViewDetails(person)" title="ดู">
                                        <i class="bi bi-eye-fill"></i>
                                    </button>
                                    <button class="btn-action btn-warning" @onclick="() => EditPerson(person)" title="แก้ไข">
                                        <i class="bi bi-pencil-fill"></i>
                                    </button>
                                    <button class="btn-action btn-dark" @onclick="() => ManageDivision(person)" title="จัดการ">
                                        <i class="bi bi-building"></i>
                                    </button>
                                    <button class="btn-action btn-danger" @onclick="() => DeletePerson(person)" title="ลบ">
                                        <i class="bi bi-trash-fill"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination-section">
            <nav>
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item disabled">
                        <a class="page-link" href="#">‹</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">4</a></li>
                    <li class="page-item"><a class="page-link" href="#">5</a></li>
                    <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                    <li class="page-item"><a class="page-link" href="#">14</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">›</a>
                    </li>
                </ul>
            </nav>
            <div class="pagination-info">
                10 / 140 หน้า
            </div>
        </div>
    </div>
</div>

<style>
    .personnel-container {
        background: #f5f7fa;
        min-height: 100vh;
        padding: 20px;
    }

    .page-header {
        background: white;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .page-title {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
        color: #333;
    }

    .content-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .filter-section {
        margin-bottom: 20px;
    }

    .search-box {
        position: relative;
    }

        .search-box input {
            padding-right: 45px;
        }

    .search-btn {
        position: absolute;
        right: 5px;
        top: 50%;
        transform: translateY(-50%);
        background: #28a745;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
    }

        .search-btn:hover {
            background: #218838;
        }

    .table-container {
        overflow-x: auto;
        margin: 20px 0;
    }

    .personnel-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 14px;
    }

        .personnel-table thead th {
            background: #f8f9fa;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            white-space: nowrap;
        }

        .personnel-table tbody td {
            padding: 12px 10px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }

        .personnel-table tbody tr:hover {
            background: #f8f9fa;
        }

    .status-switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 22px;
        vertical-align: middle;
    }

        .status-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 22px;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

    input:checked + .slider {
        background-color: #17a2b8;
    }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

    .action-buttons {
        display: flex;
        gap: 5px;
    }

    .btn-action {
        width: 32px;
        height: 32px;
        padding: 0;
        border: none;
        border-radius: 4px;
        color: white;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

        .btn-action:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }

    .btn-info {
        background: #17a2b8;
    }

    .btn-warning {
        background: #ffc107;
    }

    .btn-dark {
        background: #343a40;
    }

    .btn-danger {
        background: #dc3545;
    }

    .pagination-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 15px;
        border-top: 1px solid #dee2e6;
    }

    .pagination-info {
        color: #6c757d;
        font-size: 14px;
    }

    .badge {
        font-size: 11px;
        padding: 3px 8px;
    }

    .form-select-sm {
        font-size: 13px;
        padding: 5px 10px;
    }

    .btn-success {
        background: #28a745;
        border: none;
        padding: 8px 16px;
        font-size: 14px;
    }

        .btn-success:hover {
            background: #218838;
        }
</style>

@code {
    private List<Personnel> personnel = new();
    private string searchText = "";
    private string filterFirstName = "";
    private string filterLastName = "";
    private string filterEmail = "";
    private string filterDivision1 = "";
    private string filterDivision2 = "";
    private string filterPosition = "";
    private string filterStatus = "";
    private string filterAction = "";

    protected override void OnInitialized()
    {
        LoadPersonnel();
    }

    private void LoadPersonnel()
    {
        personnel = new List<Personnel>
        {
            new Personnel
            {
                EmployeeCode = "ผู้บุคลากร",
                FirstNameThai = "สมชาย",
                LastNameThai = "ใจดี",
                FullNameEnglish = "Admin",
                Email = "psu.edocument@gmail.com",
                Division1 = "มหาวิทยาลัยสงขลานครินทร์",
                Division2 = "",
                CareerPath = "กิจกรรม",
                IsActive = true
            },
            new Personnel
            {
                EmployeeCode = "ผู้บุคลากร",
                FirstNameThai = "วัลลภ",
                LastNameThai = "สายนาค",
                FullNameEnglish = "CHEERASAK SAYNAK",
                Email = "cheerasak.s@psu.ac.th",
                Division1 = "มหาวิทยาลัยสงขลานครินทร์",
                Division2 = "คณะวิทยาการจัดการ",
                CareerPath = "กิจกรรม",
                IsActive = true
            },
            new Personnel
            {
                EmployeeCode = "ผู้บุคลากร",
                FirstNameThai = "จักรกฤษณ์",
                LastNameThai = "โชติเสถียรกุล",
                FullNameEnglish = "JAKKRIT CHOTISETTHAKUNZ",
                Email = "jakkrit.ch@psu.ac.th",
                Division1 = "มหาวิทยาลัยสงขลานครินทร์",
                Division2 = "",
                CareerPath = "กิจกรรม",
                IsActive = true
            },
            new Personnel
            {
                EmployeeCode = "ผู้บุคลากร",
                FirstNameThai = "นภาลัย",
                LastNameThai = "หอธง",
                FullNameEnglish = "NAPARAT HORTHONG",
                Email = "naparat.h@psu.ac.th",
                Division1 = "มหาวิทยาลัยสงขลานครินทร์",
                Division1Note = "Momsintud",
                Division2 = "",
                CareerPath = "กิจกรรม",
                IsActive = true
            },
            new Personnel
            {
                EmployeeCode = "ผู้บุคลากร",
                FirstNameThai = "วชิรวิทย์",
                LastNameThai = "จิวานันท์",
                FullNameEnglish = "WACHIRAWIT JIWANIT",
                Email = "wachirawit.j@psu.ac.th",
                Division1 = "มหาวิทยาลัยสงขลานครินทร์",
                Division2 = "",
                CareerPath = "กิจกรรม",
                IsActive = true
            },
            new Personnel
            {
                EmployeeCode = "ผู้บุคลากร",
                FirstNameThai = "เอกลักษณ์",
                LastNameThai = "อิ่มธุรกรรม",
                FullNameEnglish = "AERKAST AISUMAN",
                Email = "6110110546@email.psu.ac.th",
                Division1 = "มหาวิทยาลัยสงขลานครินทร์",
                Division2 = "คณะวิทยาการจัดการ",
                CareerPath = "กิจกรรม",
                IsActive = true
            },
            new Personnel
            {
                EmployeeCode = "ผู้บุคลากร",
                FirstNameThai = "ธุชกาล",
                LastNameThai = "หนูเอียด",
                FullNameEnglish = "Thichalom Noo-eid",
                Email = "6510210459@email.psu.ac.th",
                Division1 = "มหาวิทยาลัยสงขลานครินทร์",
                Division2 = "",
                CareerPath = "กิจกรรม",
                IsActive = true
            },
            new Personnel
            {
                EmployeeCode = "ผู้บุคลากร",
                FirstNameThai = "ดวงธิดา",
                LastNameThai = "ชุมหลี",
                FullNameEnglish = "DUANGTHIDA CHOOMLEE",
                Email = "duangthida.c@psu.ac.th",
                Division1 = "มหาวิทยาลัยสงขลานครินทร์",
                Division2 = "คณะวิทยาการจัดการ",
                CareerPath = "กิจกรรม",
                IsActive = true
            },
            new Personnel
            {
                EmployeeCode = "ผู้บุคลากร",
                FirstNameThai = "โชติ",
                LastNameThai = "ดีจ๊ะ",
                FullNameEnglish = "Jasdee Deejal",
                Email = "naparat.h@psu.ac.th",
                Division1 = "มหาวิทยาลัยสงขลานครินทร์",
                Division2 = "",
                CareerPath = "กิจกรรม",
                IsActive = true
            },
            new Personnel
            {
                EmployeeCode = "ผู้บุคลากร",
                FirstNameThai = "มนทน",
                LastNameThai = "ทองมี",
                FullNameEnglish = "monton thongme",
                Email = "chompoothchl1@gmail.com",
                Division1 = "กรรมการสภา",
                Division2 = "",
                CareerPath = "ไม่กิจกรรม",
                IsActive = false
            }
        };
    }

    private IEnumerable<Personnel> FilteredPersonnel
    {
        get
        {
            var filtered = personnel.AsEnumerable();

            if (!string.IsNullOrWhiteSpace(searchText))
            {
                filtered = filtered.Where(p =>
                    p.FullNameThai.Contains(searchText, StringComparison.OrdinalIgnoreCase) ||
                    p.FullNameEnglish.Contains(searchText, StringComparison.OrdinalIgnoreCase) ||
                    p.Email.Contains(searchText, StringComparison.OrdinalIgnoreCase));
            }

            if (!string.IsNullOrWhiteSpace(filterStatus))
            {
                bool isActive = filterStatus == "Active";
                filtered = filtered.Where(p => p.IsActive == isActive);
            }

            return filtered;
        }
    }

    private void ShowAddModal()
    {
        // TODO: Show add personnel modal
    }

    private void ViewDetails(Personnel person)
    {
        // TODO: View details
    }

    private void EditPerson(Personnel person)
    {
        // TODO: Edit person
    }

    private void ManageDivision(Personnel person)
    {
        // TODO: Manage division
    }

    private void DeletePerson(Personnel person)
    {
        // TODO: Delete person
    }

    public class Personnel
    {
        public string EmployeeCode { get; set; }
        public string FirstNameThai { get; set; }
        public string LastNameThai { get; set; }
        public string FullNameThai => $"{FirstNameThai} {LastNameThai}";
        public string FullNameEnglish { get; set; }
        public string Email { get; set; }
        public string Division1 { get; set; }
        public string Division1Note { get; set; }
        public string Division2 { get; set; }
        public string CareerPath { get; set; }
        public bool IsActive { get; set; }
    }
}