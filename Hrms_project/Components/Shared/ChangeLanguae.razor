@using Hrms_project.Service
@inject JsonLocalizationService LocService
@inject NavigationManager Nav
@inject IJSRuntime JSRuntime

<div class="d-flex align-items-center me-3">
    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" role="switch" id="langSwitch"
               checked="@(LocService.CurrentCulture == "th-TH")"
               @onchange="ToggleLanguage"
               style="cursor: pointer; transform: scale(1.2);">
        <label class="form-check-label ms-2 fw-bold text-white" for="langSwitch" style="font-size: 14px;">
            @(LocService.CurrentCulture == "th-TH" ? "ภาษาไทย (TH)" : "English (EN)")
        </label>
    </div>
</div>

@code {
    private async Task ToggleLanguage(ChangeEventArgs e)
    {
        // ถ้า checked (true) ให้เป็น th-TH, ถ้าไม่ (false) ให้เป็น en-US
        bool isThai = (bool)(e.Value ?? false);
        string newCulture = isThai ? "th-TH" : "en-US";

        // 1. บันทึกลง LocalStorage
        await JSRuntime.InvokeVoidAsync("localStorage.setItem", "selectedCulture", newCulture);

        // 2. สั่งเปลี่ยนภาษาใน Service
        await LocService.SetCulture(newCulture);

        Console.WriteLine($"[Toggle] Switched to: {newCulture}");
    }
}